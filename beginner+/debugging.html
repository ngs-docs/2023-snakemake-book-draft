<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Techniques for debugging snakemake workflows - An Introduction to Snakemake for Bioinformatics</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././extra/mdbook-admonish.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../acknowledgements.html"><strong aria-hidden="true">2.</strong> Acknowledgements</a></li><li class="chapter-item expanded "><a href="../chapter_0.html"><strong aria-hidden="true">3.</strong> Section 1 - A Stepwise Introduction to Snakemake</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter_1.html"><strong aria-hidden="true">3.1.</strong> Chapter 1 - snakemake runs programs for you!</a></li><li class="chapter-item expanded "><a href="../chapter_2.html"><strong aria-hidden="true">3.2.</strong> Chapter 2 - snakemake connects rules for you!</a></li><li class="chapter-item expanded "><a href="../chapter_3.html"><strong aria-hidden="true">3.3.</strong> Chapter 3 - snakemake helps you avoid redundancy!</a></li></ol></li><li class="chapter-item expanded "><a href="../section_2.html"><strong aria-hidden="true">4.</strong> Section 2 - Building an even more useful Snakefile</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter_4.html"><strong aria-hidden="true">4.1.</strong> Chapter 4 - running rules in parallel</a></li><li class="chapter-item expanded "><a href="../chapter_5.html"><strong aria-hidden="true">4.2.</strong> Chapter 5 - visualizing workflows</a></li><li class="chapter-item expanded "><a href="../chapter_6.html"><strong aria-hidden="true">4.3.</strong> Chapter 6 - using wildcards to make rules more generic</a></li><li class="chapter-item expanded "><a href="../chapter_7.html"><strong aria-hidden="true">4.4.</strong> Chapter 7 - giving snakemake filenames instead of rule names</a></li><li class="chapter-item expanded "><a href="../chapter_8.html"><strong aria-hidden="true">4.5.</strong> Chapter 8 - adding new genomes</a></li><li class="chapter-item expanded "><a href="../chapter_9.html"><strong aria-hidden="true">4.6.</strong> Chapter 9 - using expand to make filenames</a></li><li class="chapter-item expanded "><a href="../chapter_10.html"><strong aria-hidden="true">4.7.</strong> Chapter 10 - using default rules</a></li><li class="chapter-item expanded "><a href="../chapter_11.html"><strong aria-hidden="true">4.8.</strong> Chapter 11 - our final Snakefile - review and discussion</a></li></ol></li><li class="chapter-item expanded "><a href="../section_3.html"><strong aria-hidden="true">5.</strong> Section 3 - Beyond Your First Snakefile</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../beginner+/input-and-output-blocks.html"><strong aria-hidden="true">5.1.</strong> input: and output: blocks</a></li><li class="chapter-item expanded "><a href="../beginner+/wildcards.html"><strong aria-hidden="true">5.2.</strong> Using wildcards to generalize your rules</a></li><li class="chapter-item expanded "><a href="../beginner+/params-blocks.html"><strong aria-hidden="true">5.3.</strong> params: blocks and {params}</a></li><li class="chapter-item expanded "><a href="../beginner+/expand.html"><strong aria-hidden="true">5.4.</strong> Using expand to generate filenames</a></li><li class="chapter-item expanded "><a href="../beginner+/targets.html"><strong aria-hidden="true">5.5.</strong> Running rules and choosing targets from the command line</a></li><li class="chapter-item expanded "><a href="../beginner+/debugging.html" class="active"><strong aria-hidden="true">5.6.</strong> Techniques for debugging snakemake workflows</a></li><li class="chapter-item expanded "><a href="../beginner+/syntax.html"><strong aria-hidden="true">5.7.</strong> Basic syntax rules for Snakefiles</a></li><li class="chapter-item expanded "><a href="../beginner+/visualizing.html"><strong aria-hidden="true">5.8.</strong> Visualizing your workflow</a></li><li class="chapter-item expanded "><a href="../beginner+/string-formatting.html"><strong aria-hidden="true">5.9.</strong> String formatting "minilanguage"</a></li><li class="chapter-item expanded "><a href="../beginner+/config.html"><strong aria-hidden="true">5.10.</strong> Using configuration files</a></li></ol></li><li class="chapter-item expanded "><a href="../section_4.html"><strong aria-hidden="true">6.</strong> Section 4 - Snakemake Patterns and Recipes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../recipes/subsampling-files.html"><strong aria-hidden="true">6.1.</strong> Subsampling FASTQ files</a></li><li class="chapter-item expanded "><a href="../recipes/splitting-files.html"><strong aria-hidden="true">6.2.</strong> Using split to split up files</a></li><li class="chapter-item expanded "><a href="../recipes/replacing-for.html"><strong aria-hidden="true">6.3.</strong> Applying one rule to to many files - replacing for loops in shell scripts</a></li><li class="chapter-item expanded "><a href="../recipes/never-fail-me.html"><strong aria-hidden="true">6.4.</strong> Never fail me - how to make shell commands always succeed</a></li><li class="chapter-item expanded "><a href="../recipes/params-functions.html"><strong aria-hidden="true">6.5.</strong> Subsetting FASTQ files to a fixed number of records</a></li></ol></li><li class="chapter-item expanded "><a href="../section_5.html"><strong aria-hidden="true">7.</strong> Section 5 - Advanced Features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../advanced/parallel.html"><strong aria-hidden="true">7.1.</strong> Beyond -j - parallelizing snakemake</a></li><li class="chapter-item expanded "><a href="../advanced/resources.html"><strong aria-hidden="true">7.2.</strong> Resource constraints and job management</a></li></ol></li><li class="chapter-item expanded "><a href="../section_6.html"><strong aria-hidden="true">8.</strong> Section 6 - A Reference Guide for Snakemake Features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/wildcard-constraints.html"><strong aria-hidden="true">8.1.</strong> Wildcard constraints</a></li><li class="chapter-item expanded "><a href="../reference/namespaces.html"><strong aria-hidden="true">8.2.</strong> Namespaces</a></li></ol></li><li class="chapter-item expanded "><a href="../appendix/index.html"><strong aria-hidden="true">9.</strong> Appendix</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../appendix/unix-shell.html"><strong aria-hidden="true">9.1.</strong> UNIX shell basics</a></li><li class="chapter-item expanded "><a href="../appendix/conda-and-mamba.html"><strong aria-hidden="true">9.2.</strong> Getting started with conda and mamba</a></li><li class="chapter-item expanded "><a href="../appendix/git-basics.html"><strong aria-hidden="true">9.3.</strong> Git basics</a></li><li class="chapter-item expanded "><a href="../appendix/shell-scripts.html"><strong aria-hidden="true">9.4.</strong> UNIX and scripting: executing text files</a></li><li class="chapter-item expanded "><a href="../appendix/workflow-friendly-software.html"><strong aria-hidden="true">9.5.</strong> Writing software that is workflow-friendly</a></li><li class="chapter-item expanded "><a href="../appendix/python.html"><strong aria-hidden="true">9.6.</strong> Python basics</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">An Introduction to Snakemake for Bioinformatics</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="techniques-for-debugging-workflow-execution-and-fixing-problems"><a class="header" href="#techniques-for-debugging-workflow-execution-and-fixing-problems">Techniques for debugging workflow execution (and fixing problems!)</a></h1>
<h2 id="some-initial-words-of-wisdom"><a class="header" href="#some-initial-words-of-wisdom">Some initial words of wisdom</a></h2>
<p>Debugging complex computer situations is an art -- or, at least, it is
not easily systematized.  There are guidelines and even rules to
debugging, but no single procedure or approach that is guaranteed to work.</p>
<p>This chapter focuses on <em>how to debug</em> snakemake workflows. The odds
are that you're reading this chapter because you are trying hard to
get something to work. Heck, you're probably only reading this
sentence because you're desperate.</p>
<p>Below are the most useful pieces of advice we can give you about debugging
at this point in your snakemake journey.</p>
<p>First, simplify the workflow as much as possible so that it is fast to
run. For example, reduce the number of samples to 1 or 2 (@@)
and subsample input files so that they are small. This will make it
faster to run and decrease the time between testing your results.</p>
<p>Second, focus on one rule at a time. Run each rule, one by one, until
you find one that is not doing what you want it to do. Then focus on
fixing that. This will provide you with an increasingly solid path
through the snakemake rules.</p>
<p>Third, print out the commands being run (using <code>-p</code>) and examine
the wildcards in the snakemake output carefully. Make sure both the
commands and the wildcard values are what you expect. Find the first
rule where they aren't and fix that rule. This will ensure that
at each stage, your wildcards are ...</p>
<h2 id="the-three-stages-of-snakemake-debugging"><a class="header" href="#the-three-stages-of-snakemake-debugging">The three stages of snakemake debugging</a></h2>
<p>There are three common stages of debugging you'll encounter when
creating or modifying a snakemake workflow.</p>
<p>First, you'll have syntax errors caused by mismatched indentation and
whitespace, as well as mismatched quotes. These errors will prevent
snakemake from reading your Snakefile.</p>
<p>Second, you'll find problems connecting rules and filling in wildcards.
This will prevent snakemake from executing any jobs.</p>
<p>And third, you'll have actual execution errors that make specific rules
or jobs fail. These errors will prevent your workflow from finishing.</p>
<p>This chapter will cover the sources of the most common types of
these errors, and will also provide tips and techniques for avoiding or
fixing many of them.</p>
<ul>
<li>intermediate targets</li>
<li>debug-dag</li>
<li>logs</li>
<li>print in Snakefile (use file=)</li>
<li>finding and reading error messages - silence, killed, etc.</li>
<li>running in single-CPU mode</li>
<li>whitespace</li>
<li>filling in wildcards</li>
<li>use <code>--until</code> to specify a rule to go to</li>
<li>focus on one wildcard at a time</li>
<li>thought: maybe do a thing where we really dig into a set of debugging?</li>
</ul>
<p>@@ suggested procedure after syntax: first run with -j big and -k; then everything left will be blocking errors.</p>
<div id="admonition-after-the-syntax-errors-running-your-snakemake-workflow" class="admonition info">
<div class="admonition-title">
<p>After the syntax errors: running your snakemake workflow</p>
<p><a class="admonition-anchor-link" href="#admonition-after-the-syntax-errors-running-your-snakemake-workflow"></a></p>
</div>
<div>
<p>Here is a short list of tactics to use when trying to debug execution
errors in your snakemake workflow -- that is, <em>after</em> you resolve
any syntax errors preventing snakemake from reading the Snakefile.</p>
<ol>
<li>Run snakemake with <code>-n/--dry-run</code>, and inspect the output. This will
tell you if the snakemake workflow will run the rules and produce
the output you're actually interested in.</li>
<li>Run snakemake with <code>-j/--cores 1</code>. This will run your jobs one after
the other, in serial mode; this will make the output from snakemake
jobs less confusing, because only one job will be running at a time.</li>
<li>Run snakemake with <code>-p/--printshellcmds</code>. This will print out the
actual shell commands that are being run.</li>
<li>Run just the rules you're trying to debug by specifying either the
rule name or a filename on the command line (see
<a href="targets.html">Running rules and choosing targets from the command line</a>
for more information).</li>
</ol>
</div>
</div>
<h2 id="finding-fixing-and-avoiding-syntax-errors"><a class="header" href="#finding-fixing-and-avoiding-syntax-errors">Finding, fixing, and avoiding syntax errors.</a></h2>
<h3 id="whitespace-and-indentation-errors-finding-fixing-and-avoiding-them"><a class="header" href="#whitespace-and-indentation-errors-finding-fixing-and-avoiding-them">Whitespace and indentation errors: finding, fixing, and avoiding them.</a></h3>
<p>Use a good editor, e.g. vscode or some other text editor. Put it in snakemake
mode or Python mode (spaces etc.)</p>
<h3 id="syntax-errors-newlines-and-quoting"><a class="header" href="#syntax-errors-newlines-and-quoting">Syntax errors, newlines, and quoting.</a></h3>
<p>triple quotes vs single quotes</p>
<p>deleting lines.</p>
<h2 id="debugging-snakefile-workflow-declarationsspecifications-"><a class="header" href="#debugging-snakefile-workflow-declarationsspecifications-">Debugging Snakefile workflow declarations/specifications @@</a></h2>
<h3 id="missinginputexception"><a class="header" href="#missinginputexception"><code>MissingInputException</code></a></h3>
<p>One of the most common errors to encounter when writing a new workflow
is a <code>MissingInputException</code>. This is snakemake's way of saying three things:
first, it has figured out that it <em>needs</em> a particular file; second,
that file does not already exist; and third,
it doesn't know how to <em>make</em> that file (i.e. there's no rule that produces
that file).</p>
<p>For example, consider this very simple workflow file:</p>
<pre><code class="language-python"># expect_fail

rule example:
    input:
        &quot;file-does-not-exist&quot;
</code></pre>
<p>When we run it, we get:</p>
<pre><code>MissingInputException in rule example in file /Users/t/dev/2023-snakemake-book-draft/code/examples/errors.simple-fail/snakefile.missing-input, line 1:
Missing input files for rule example:
    affected files:
        file-does-not-exist
</code></pre>
<p>This error comes up in two common situations: either there is an input
file that you were supposed to provide the workflow but that is
missing (e.g. a missing FASTQ file); or the rule that is supposed to
produce this file (as an output) doesn't properly match.</p>
<h3 id="missingoutputexception-and-increasing---latency-wait"><a class="header" href="#missingoutputexception-and-increasing---latency-wait"><code>MissingOutputException</code> and increasing <code>--latency-wait</code></a></h3>
<p>Sometimes you will see an error message that mentions a
<code>MissingOutputException</code> and suggests increasing the wait time with
<code>--latency-wait</code>.  This is most frequently a symptom of a rule that
does not properly create an expected output file.</p>
<p>For example, consider:</p>
<pre><code class="language-python"># expect_fail

rule example:
    output:
       &quot;file-does-not-exist&quot;
    shell: &quot;&quot;&quot;
       touch file-does-not-exist-typo
    &quot;&quot;&quot;   
</code></pre>
<p>Here we have a simple rule whose output block specifies that it will
create a file named <code>file-does-not-exist</code>, but (due to a typo in the
shell command) creates the wrong file instead. If we run this, we will
get the following message:</p>
<pre><code>Waiting at most 5 seconds for missing files.
MissingOutputException in rule example in file /Users/t/dev/2023-snakemake-book-draft/code/examples/errors.simple-fail/snakefile.missing-output, line 3:
Job 0 completed successfully, but some output files are missing. Missing files after 5 seconds. This might be due to filesystem latency. If that is the case, consider to increase the wait time with --latency-wait:
file-does-not-exist
</code></pre>
<p>First, let's remember that the <code>output:</code> block is simply an
<em>annotation</em>, not a directive: it's telling snakemake what this rule
is <em>supposed</em> to create, without actually creating it @@ (link to
input-output here).  The part of the rule that <em>creates</em> the file is
typically the <code>shell:</code> block, and, here, we've made a mistake in the
shell block, and are creating the wrong file.</p>
<p><strong>There's no simple way for snakemake to know what files were actually
created by a shell block</strong>, so snakemake doesn't try: it simple complains
that we <em>said</em> running this rule would create a particular file, but
it <em>didn't</em> create that file when we ran it. That's what
<code>MissingOutputException</code> generally means.</p>
<p>To fix this, we need to look at the shell command and understand why it is
not creating the desired file. That can get complicated, but one common
fix is to avoid writing filenames redundantly and instead use <code>{output}</code>
patterns in the shell block so that you don't accidentally use
different names in the <code>output:</code> block and in the <code>shell:</code> block.</p>
<p>So then what is this message about waiting 5 seconds for missing
files, and/or increasing <code>--latency-wait</code>? This refers to an advanced
situation (discussed @@later) that can occur when we are writing to a
shared network file system from jobs running on multiple machines. If
you're running snakemake on a single machine, this should never be a
problem! We'll defer discussion of this until later.</p>
<h3 id="workflowerror-and-wildcards"><a class="header" href="#workflowerror-and-wildcards"><code>WorkflowError</code> and wildcards</a></h3>
<p>Another common error is a `WorfklowError: Target rules may not contain
wildcards.&quot; This occurs when snakemake is asked to run a rule that contains
wildcards.</p>
<p>Consider:</p>
<pre><code class="language-python"># expect_fail

rule example:
    input: &quot;{name}.input&quot;
    output: &quot;{name}.output&quot;
    shell: &quot;cp {input} {output}&quot;
</code></pre>
<p>which generates:</p>
<pre><code>WorkflowError:
Target rules may not contain wildcards. Please specify concrete files or a rule without wildcards at the command line, or have a rule without wildcards at the very top of your workflow (e.g. the typical &quot;rule all&quot; which just collects all results you want to generate in the end).
</code></pre>
<p>This error occurs in this case because there is only one rule in the
snakemake workflow, and when werun <code>snakemake</code> it will default to
running that rule as its target. However, that rule uses
<a href="wildcards.html">wildcards</a> in its output block, and hence cannot be a
target.</p>
<p>You can also encounter this error when you specify a rule name explicitly;
if the rule you ask snakemake to run by name contains a wildcard in its
output block, you can't run the rule directly - you have to give it a
filename that snakemake can use to infer the wildcard.</p>
<p>In either case, the solution is to either ask snakemake to build a
filename, or give snakemake a target that does not include
wildcards. For example, if the file <code>XYZ.input</code> existed in the
directory, here we could either specify <code>XYZ.output</code> on the command
line, or we could write a new default rule that specified the name
<code>XYZ.output</code> as a pseudo-target:</p>
<pre><code class="language-python">rule all:
    input:
        &quot;XYZ.output&quot;
</code></pre>
<p>Either solution has the effect of providing the rule <code>example</code> with a value
to substitute for the wildcard <code>name</code>.</p>
<p>See
<a href="wildcards.html#all-wildcards-used-in-a-rule-must-match-to-wildcards-in-the-output-block">Using wildcards to generalize your rules</a>
and <a href="targets.html">Targets</a> for more information.</p>
<h2 id="debugging-running-snakemake-workflows"><a class="header" href="#debugging-running-snakemake-workflows">Debugging running snakemake workflows</a></h2>
<h2 id="run-your-rules-once-target-at-a-time"><a class="header" href="#run-your-rules-once-target-at-a-time">Run your rules once target at a time.</a></h2>
<h2 id="run-your-rules-one-job-at-a-time"><a class="header" href="#run-your-rules-one-job-at-a-time">Run your rules one job at a time.</a></h2>
<h2 id="finding-and-interpreting-error-messages"><a class="header" href="#finding-and-interpreting-error-messages">Finding and interpreting error messages</a></h2>
<h3 id="display-of-error-messages-for-failed-commands"><a class="header" href="#display-of-error-messages-for-failed-commands">Display of error messages for failed commands</a></h3>
<h2 id="running-all-the-rules-you-can-with--k--keep-going"><a class="header" href="#running-all-the-rules-you-can-with--k--keep-going">Running all the rules you can with <code>-k/--keep-going</code></a></h2>
<p>Snakemake has a slightly confusing presentation of error messages from
shell commands: the messages appear <em>above</em> the notification that the
rule failed</p>
<p>Consider the following Snakefile:</p>
<pre><code class="language-python"># expect_fail

rule hello_fail:
    shell: &quot;&quot;&quot;
        ls file-does-not-exist
    &quot;&quot;&quot;
</code></pre>
<p>When you run this in a directory that does <em>not</em> contain the file named <code>file-does-not-exist</code>, you will see the following output:</p>
<pre><code>[Fri Apr 14 14:59:29 2023]                 
rule hello_fail:
    jobid: 0
    reason: Rules with neither input nor output files are always executed.
    resources: tmpdir=/var/folders/6s/_f373w1d6hdfjc2kjstq97s80000gp/T

ls: cannot access 'file-does-not-exist': No such file or directory
[Fri Apr 14 14:59:29 2023]
Error in rule hello_fail:
    jobid: 0
    shell:
        
        ls file-does-not-exist
    
        (one of the commands exited with non-zero exit code; note that snakemake uses bash strict mode!)
</code></pre>
<p>There are three parts to this output:</p>
<ul>
<li>
<p>the first part starts at <code>rule hello_fail:</code>, and declares that snakemake
is going to run this rule, and gives the reason why.</p>
</li>
<li>
<p>the second part contains the error message from running that
command - here, <code>ls</code> fails because the file in question does not
exist, and so it prints out <code>ls: cannot access 'file-does-not-exist': No such file or directory </code>. <strong>This is the error
output by the failed command.</strong></p>
</li>
<li>
<p>the third part starts at &quot;Error in rule hello_fail&quot; and describes the
rule that failed: its name <code>hello_fail</code>, its jobid, and the shell command
that was run (<code>ls file-does-not-exist</code>), together with some information
about how the failure was detected (a non-zero exit code @@) and how the
shell command was run (in so-called &quot;strict mode&quot; @@).</p>
</li>
</ul>
<p>The somewhat non-intuitive part here is that the error message that is
specific to the failed rule - that the file in question did not exist -
appears <em>above</em> the notification of failure.</p>
<p>There are some good reasons for this (@@ something to do about stdout capture)
and various ways to change this behavior (@@ logging) but, <em>by default</em>,
this is how snakemake reports errors in shell commands.</p>
<p>What this means in practice is that when you are debugging a failed
shell command, the place to look for the snakemake error is <em>above</em>
the notification of the failure!</p>
<p>@@ describe bash strict mode</p>
<p>@@ describe (briefly) logging</p>
<p>@@ when running with -j more than 1</p>
<h3 id="out-of-memory-errors-killed"><a class="header" href="#out-of-memory-errors-killed">Out of memory errors: &quot;Killed&quot;.</a></h3>
<p>CTB: is it lowercase or uppercase?</p>
<p>Sometimes you will see a &quot;rule failed&quot; @@ error from snakemake, and
the only error message that you will be able to find is &quot;killed&quot;.
What is this?</p>
<p>This generally means that your shell command (or shell process) was
terminated by an unavoidable signal from the operating system - and
the most common such signal is an out-of-memory error.</p>
<p>When a process uses too much memory, the default behavior of the
operating system is to <em>immediately</em> terminate it - there's not much
else to be done.  Unfortunately, the default error message explaining this
is somewhat lacking.</p>
<p>There is no single way to <em>fix</em> this problem, unfortunately. A few
general strategies include:</p>
<ul>
<li>switching to a system with more memory, or (if you are using a queuing
system like slurm) requesting more memory for your job.</li>
<li>if you are using a program that asks you to specify an amount of
memory to use (e.g. some assemblers, or any java program), you can
decrease the amount of memory you request on the command line.</li>
<li>you can also decrease the size of the dataset you are using, perhaps
by subdividing it or sub-sampling @@.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../beginner+/targets.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../beginner+/syntax.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../beginner+/targets.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../beginner+/syntax.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
